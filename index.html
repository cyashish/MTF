<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTF Position Tracker</title>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <div>
                <h1>MTF Position Tracker</h1>
                <p class="text-sm text-muted">FIFO Position Accounting & Breakeven Analysis</p>
            </div>
            <div>
                <!-- Header Actions if needed -->
            </div>
        </header>

        <main>
            <!-- Input Section -->
            <section class="card">
                <div class="card-header">
                    <div class="card-title">Import Data</div>
                </div>

                <div class="input-group">
                    <label class="text-sm text-muted" style="display:block; margin-bottom: 0.5rem;">Paste Trade Data
                        (CSV or Copied List)</label>
                    <textarea id="pasteInput" placeholder="Paste your trade list here...
Example:
NSE
06/10/2025
ICICIBANK
D
B
250..."></textarea>
                </div>

                <div class="flex" style="align-items: center;">
                    <button id="btnProcess">
                        <span id="loadingSpinner" class="loading hidden"></span>
                        Process Trades
                    </button>
                    <!-- <button class="secondary">Load Example Data</button> -->
                    <span id="statusMsg" class="text-sm text-muted" style="margin-left: auto;"></span>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="card" style="margin-bottom: 2rem;">
                <div class="card-header" style="margin-bottom: 0;">
                    <div class="card-title" style="font-size: 1rem; cursor: pointer; user-select: none;"
                        onclick="document.getElementById('settingsBody').classList.toggle('hidden')">
                        ⚙️ Calculation Settings (Click to expand)
                    </div>
                </div>
                <div id="settingsBody" class="hidden"
                    style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <div class="grid">
                        <div class="input-group">
                            <label class="text-sm text-muted">Funding Ratio (Loan %)</label>
                            <input type="range" id="fundingRatio" min="0" max="1" step="0.05" value="1"
                                oninput="document.getElementById('fundVal').innerText = (this.value*100) + '%'; APP.recalculate()"
                                style="width: 100%; margin-top: 0.5rem; accent-color: var(--accent-primary);">
                            <div style="display: flex; justify-content: space-between;">
                                <span class="text-sm">0%</span>
                                <span id="fundVal" class="text-sm"
                                    style="color: var(--accent-primary); font-weight: bold;">100%</span>
                            </div>
                            <p class="text-sm text-muted" style="margin-top: 0.25rem; font-size: 0.8rem;">Reduce if you
                                paid cash.</p>
                        </div>
                        <div class="input-group">
                            <label class="text-sm text-muted">Interest Start Delay (Days)</label>
                            <input type="number" id="interestDelay" value="0" min="0" max="5" class="input-field"
                                onchange="APP.recalculate()">
                            <p class="text-sm text-muted" style="margin-top: 0.25rem; font-size: 0.8rem;">Usually 0 or
                                2.</p>
                        </div>
                        <div class="input-group">
                            <label class="text-sm text-muted">Interest Rate (% p.a.)</label>
                            <input type="number" id="interestRate" value="18" step="0.5" class="input-field"
                                onchange="CONFIG.mtfInterestRate = this.value/100; APP.recalculate()">
                        </div>
                        <div class="input-group">
                            <label class="text-sm text-muted">Custom Target (%)</label>
                            <input type="number" id="customTarget" value="10" step="1" class="input-field"
                                onchange="APP.recalculate()">
                        </div>
                        <div class="input-group" style="display: flex; flex-direction: column;">
                            <label class="text-sm text-muted" for="showUnrealized" style="margin-bottom: 0.5rem;">Show
                                Unrealized P&L</label>
                            <div style="display: flex; align-items: center; padding: 0.4rem 0;">
                                <input type="checkbox" id="showUnrealized" checked onchange="APP.recalculate()"
                                    style="width: 20px; height: 20px; accent-color: var(--accent-primary);">
                                <span class="text-sm text-muted" style="margin-left: 0.5rem;">Enabled</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dashboard Section (Hidden initially) -->
            <div id="dashboard" class="hidden">
                <!-- Summary Cards -->
                <div id="summaryContainer" style="margin-bottom: 2rem;"></div>

                <!-- Main Table -->
                <section class="card">
                    <div class="card-header">
                        <div class="card-title">Open Positions</div>
                        <button class="secondary" onclick="APP.copyAll()" style="font-size: 0.8rem;">
                            Copy All Sell Orders
                        </button>
                    </div>
                    <div id="tableContainer" class="table-container">
                        <!-- Table rendered here -->
                    </div>
                </section>

                <!-- Closed Positions Table -->
                <section class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <div class="card-title">Realized Profit & Loss (Approx)</div>
                    </div>
                    <div id="closedTableContainer" class="table-container">
                        <!-- Closed table rendered here -->
                    </div>
                </section>

                <!-- Unrealized P&L Table -->
                <section class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <div class="card-title">Unrealized P&L (Open Positions)</div>
                    </div>
                    <div id="unrealizedTableContainer" class="table-container">
                        <!-- Unrealized table rendered here -->
                    </div>
                </section>
            </div>
        </main>

        <footer class="mt-2 text-sm text-muted" style="text-align: center;">
            <p>Calculations include Brokerage (0.04%), STT, Txn Charges, GST, and MTF Interest (18% p.a.).</p>
            <p style="margin-top: 0.5rem; opacity: 0.6;">Local-only processing. No data is sent to any server.</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="calculator.js"></script>
    <script src="dataHandler.js"></script>
    <script src="components.js"></script>
    <script src="app.js"></script>
</body>

</html>